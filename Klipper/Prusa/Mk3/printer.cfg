#PPPPPPPPPPPPPPPPP   RRRRRRRRRRRRRRRRR   UUUUUUUU     UUUUUUUU   SSSSSSSSSSSSSSS              AAA                    MMMMMMMM               MMMMMMMMKKKKKKKKK    KKKKKKK 333333333333333      SSSSSSSSSSSSSSS                                                                            
#P::::::::::::::::P  R::::::::::::::::R  U::::::U     U::::::U SS:::::::::::::::S            A:::A                   M:::::::M             M:::::::MK:::::::K    K:::::K3:::::::::::::::33  SS:::::::::::::::S                                                                           
#P::::::PPPPPP:::::P R::::::RRRRRR:::::R U::::::U     U::::::US:::::SSSSSS::::::S           A:::::A                  M::::::::M           M::::::::MK:::::::K    K:::::K3::::::33333::::::3S:::::SSSSSS::::::S                                                                           
#PP:::::P     P:::::PRR:::::R     R:::::RUU:::::U     U:::::UUS:::::S     SSSSSSS          A:::::::A                 M:::::::::M         M:::::::::MK:::::::K   K::::::K3333333     3:::::3S:::::S     SSSSSSS       +++++++                                                             
#  P::::P     P:::::P  R::::R     R:::::R U:::::U     U:::::U S:::::S                     A:::::::::A                M::::::::::M       M::::::::::MKK::::::K  K:::::KKK            3:::::3S:::::S                   +:::::+                                                             
#  P::::P     P:::::P  R::::R     R:::::R U:::::D     D:::::U S:::::S                    A:::::A:::::A               M:::::::::::M     M:::::::::::M  K:::::K K:::::K               3:::::3S:::::S                   +:::::+                                                             
#  P::::PPPPPP:::::P   R::::RRRRRR:::::R  U:::::D     D:::::U  S::::SSSS                A:::::A A:::::A              M:::::::M::::M   M::::M:::::::M  K::::::K:::::K        33333333:::::3  S::::SSSS          +++++++:::::+++++++                                                       
#  P:::::::::::::PP    R:::::::::::::RR   U:::::D     D:::::U   SS::::::SSSSS          A:::::A   A:::::A             M::::::M M::::M M::::M M::::::M  K:::::::::::K         3:::::::::::3    SS::::::SSSSS     +:::::::::::::::::+                                                       
#  P::::PPPPPPPPP      R::::RRRRRR:::::R  U:::::D     D:::::U     SSS::::::::SS       A:::::A     A:::::A            M::::::M  M::::M::::M  M::::::M  K:::::::::::K         33333333:::::3     SSS::::::::SS   +:::::::::::::::::+                                                       
#  P::::P              R::::R     R:::::R U:::::D     D:::::U        SSSSSS::::S     A:::::AAAAAAAAA:::::A           M::::::M   M:::::::M   M::::::M  K::::::K:::::K                3:::::3       SSSSSS::::S  +++++++:::::+++++++                                                       
#  P::::P              R::::R     R:::::R U:::::D     D:::::U             S:::::S   A:::::::::::::::::::::A          M::::::M    M:::::M    M::::::M  K:::::K K:::::K               3:::::3            S:::::S       +:::::+                                                             
#  P::::P              R::::R     R:::::R U::::::U   U::::::U             S:::::S  A:::::AAAAAAAAAAAAA:::::A         M::::::M     MMMMM     M::::::MKK::::::K  K:::::KKK            3:::::3            S:::::S       +:::::+                                                             
#PP::::::PP          RR:::::R     R:::::R U:::::::UUU:::::::U SSSSSSS     S:::::S A:::::A             A:::::A        M::::::M               M::::::MK:::::::K   K::::::K3333333     3:::::3SSSSSSS     S:::::S       +++++++                                                             
#P::::::::P          R::::::R     R:::::R  UU:::::::::::::UU  S::::::SSSSSS:::::SA:::::A               A:::::A       M::::::M               M::::::MK:::::::K    K:::::K3::::::33333::::::3S::::::SSSSSS:::::S                                                                           
#P::::::::P          R::::::R     R:::::R    UU:::::::::UU    S:::::::::::::::SSA:::::A                 A:::::A      M::::::M               M::::::MK:::::::K    K:::::K3:::::::::::::::33 S:::::::::::::::SS                                                                            
#PPPPPPPPPP          RRRRRRRR     RRRRRRR      UUUUUUUUU       SSSSSSSSSSSSSSS AAAAAAA                   AAAAAAA     MMMMMMMM               MMMMMMMMKKKKKKKKK    KKKKKKK 333333333333333    SSSSSSSSSSSSSSS                                                                              
                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                        
#WWWWWWWW                           WWWWWWWW   AAA               NNNNNNNN        NNNNNNNNHHHHHHHHH     HHHHHHHHH               AAA                 OOOOOOOOO          FFFFFFFFFFFFFFFFFFFFFF                                                                                             
#W::::::W                           W::::::W  A:::A              N:::::::N       N::::::NH:::::::H     H:::::::H              A:::A              OO:::::::::OO        F::::::::::::::::::::F                                                                                             
#W::::::W                           W::::::W A:::::A             N::::::::N      N::::::NH:::::::H     H:::::::H             A:::::A           OO:::::::::::::OO      F::::::::::::::::::::F                                                                                             
#W::::::W                           W::::::WA:::::::A            N:::::::::N     N::::::NHH::::::H     H::::::HH            A:::::::A         O:::::::OOO:::::::O     FF::::::FFFFFFFFF::::F                                                                                             
# W:::::W           WWWWW           W:::::WA:::::::::A           N::::::::::N    N::::::N  H:::::H     H:::::H             A:::::::::A        O::::::O   O::::::O       F:::::F       FFFFFFrrrrr   rrrrrrrrr   aaaaaaaaaaaaa  nnnn  nnnnnnnn        cccccccccccccccc    eeeeeeeeeeee    
#  W:::::W         W:::::W         W:::::WA:::::A:::::A          N:::::::::::N   N::::::N  H:::::H     H:::::H            A:::::A:::::A       O:::::O     O:::::O       F:::::F             r::::rrr:::::::::r  a::::::::::::a n:::nn::::::::nn    cc:::::::::::::::c  ee::::::::::::ee  
#   W:::::W       W:::::::W       W:::::WA:::::A A:::::A         N:::::::N::::N  N::::::N  H::::::HHHHH::::::H           A:::::A A:::::A      O:::::O     O:::::O       F::::::FFFFFFFFFF   r:::::::::::::::::r aaaaaaaaa:::::an::::::::::::::nn  c:::::::::::::::::c e::::::eeeee:::::ee
#    W:::::W     W:::::::::W     W:::::WA:::::A   A:::::A        N::::::N N::::N N::::::N  H:::::::::::::::::H          A:::::A   A:::::A     O:::::O     O:::::O       F:::::::::::::::F   rr::::::rrrrr::::::r         a::::ann:::::::::::::::nc:::::::cccccc:::::ce::::::e     e:::::e
#     W:::::W   W:::::W:::::W   W:::::WA:::::A     A:::::A       N::::::N  N::::N:::::::N  H:::::::::::::::::H         A:::::A     A:::::A    O:::::O     O:::::O       F:::::::::::::::F    r:::::r     r:::::r  aaaaaaa:::::a  n:::::nnnn:::::nc::::::c     ccccccce:::::::eeeee::::::e
#      W:::::W W:::::W W:::::W W:::::WA:::::AAAAAAAAA:::::A      N::::::N   N:::::::::::N  H::::::HHHHH::::::H        A:::::AAAAAAAAA:::::A   O:::::O     O:::::O       F::::::FFFFFFFFFF    r:::::r     rrrrrrraa::::::::::::a  n::::n    n::::nc:::::c             e:::::::::::::::::e 
#       W:::::W:::::W   W:::::W:::::WA:::::::::::::::::::::A     N::::::N    N::::::::::N  H:::::H     H:::::H       A:::::::::::::::::::::A  O:::::O     O:::::O       F:::::F              r:::::r           a::::aaaa::::::a  n::::n    n::::nc:::::c             e::::::eeeeeeeeeee  
#        W:::::::::W     W:::::::::WA:::::AAAAAAAAAAAAA:::::A    N::::::N     N:::::::::N  H:::::H     H:::::H      A:::::AAAAAAAAAAAAA:::::A O::::::O   O::::::O       F:::::F              r:::::r          a::::a    a:::::a  n::::n    n::::nc::::::c     ccccccce:::::::e           
#         W:::::::W       W:::::::WA:::::A             A:::::A   N::::::N      N::::::::NHH::::::H     H::::::HH   A:::::A             A:::::AO:::::::OOO:::::::O     FF:::::::FF            r:::::r          a::::a    a:::::a  n::::n    n::::nc:::::::cccccc:::::ce::::::::e          
#          W:::::W         W:::::WA:::::A               A:::::A  N::::::N       N:::::::NH:::::::H     H:::::::H  A:::::A               A:::::AOO:::::::::::::OO      F::::::::FF            r:::::r          a:::::aaaa::::::a  n::::n    n::::n c:::::::::::::::::c e::::::::eeeeeeee  
#           W:::W           W:::WA:::::A                 A:::::A N::::::N        N::::::NH:::::::H     H:::::::H A:::::A                 A:::::A OO:::::::::OO        F::::::::FF            r:::::r           a::::::::::aa:::a n::::n    n::::n  cc:::::::::::::::c  ee:::::::::::::e  
#            WWW             WWWAAAAAAA                   AAAAAAANNNNNNNN         NNNNNNNHHHHHHHHH     HHHHHHHHHAAAAAAA                   AAAAAAA  OOOOOOOOO          FFFFFFFFFFF            rrrrrrr            aaaaaaaaaa  aaaa nnnnnn    nnnnnn    cccccccccccccccc    eeeeeeeeeeeeee  
                                                                                                                                                                                                                                                                                        
#Credit:
# https://github.com/dz0ny/klipper-prusa-mk3s Merci pour les contributeur
#Adaptation Wanhao Klipper PAD @Maxime3d77

#firmware
#cd Klipper
#make menuconfig
#Micro-controller Atmega AVR
#Processor model atmega2560
#make clean
#make
#Get ID:
#/dev/serial/by-id*
#Flash:
#make flash FLASH_DEVICE=/dev/serial/by-id/usb-Prusa_Research__prusa3d.com__Original_Prusa----VOTRE-ID

######################################################
#################      Fichier      ##################
######################################################
[include mainsail.cfg]
[include macros.cfg]


######################################################
################   Prusa MK3S+ - USB   ###############
######################################################
[mcu]
#serial: /dev/serial0 #Pour mode Serial
serial: /dev/ttyACM0 #Pour Mode USB
restart_method: command

######################################################
###############       Stockage PI       ##############
######################################################
[virtual_sdcard]
path: ~/printer_data/gcodes

######################################################
###############       Retractation      ##############
######################################################
[firmware_retraction]
retract_length: 1.4
retract_speed: 45
unretract_extra_length: 0
unretract_speed: 30


######################################################
#####################   Moteurs   ####################
######################################################
[stepper_x]
step_pin: PC0
dir_pin: !PL0
enable_pin: !PA7
microsteps: 16
rotation_distance: 32
endstop_pin: tmc2130_stepper_x:virtual_endstop
position_endstop: 0
position_max: 255
homing_speed: 50
homing_retract_dist: 0

[stepper_y]
step_pin: PC1
dir_pin: PL1
enable_pin: !PA6
microsteps: 16
rotation_distance: 32
endstop_pin: tmc2130_stepper_y:virtual_endstop
position_endstop: -4
position_max: 212.5
position_min: -4
homing_speed: 50
homing_retract_dist: 0

[stepper_z]
step_pin: PC2
dir_pin: !PL2
enable_pin: !PA5
microsteps: 16
rotation_distance: 8
endstop_pin: probe:z_virtual_endstop
position_max: 210
position_min: -5
homing_speed: 13.333

[tmc2130 stepper_x]
cs_pin: PG0
interpolate: True
stealthchop_threshold: 0
run_current: .281738
hold_current: .281738
sense_resistor: 0.220
diag1_pin: !PK2
driver_IHOLDDELAY: 8
driver_TPOWERDOWN: 0
driver_TBL: 2
driver_TOFF: 3
driver_HEND: 1
driver_HSTRT: 5
driver_PWM_FREQ: 2
driver_PWM_GRAD: 2
driver_PWM_AMPL: 230
driver_PWM_AUTOSCALE: True
driver_SGT: 3
interpolate: True
stealthchop_threshold: 80

[tmc2130 stepper_y]
cs_pin: PG2
interpolate: True
stealthchop_threshold: 0
run_current: .281738
hold_current: .281738
sense_resistor: 0.220
diag1_pin: !PK7
driver_IHOLDDELAY: 8
driver_TPOWERDOWN: 0
driver_TBL: 2
driver_TOFF: 3
driver_HEND: 1
driver_HSTRT: 5
driver_PWM_FREQ: 2
driver_PWM_GRAD: 2
driver_PWM_AMPL: 230
driver_PWM_AUTOSCALE: True
driver_SGT: 3
interpolate: True
stealthchop_threshold: 80

[tmc2130 stepper_z]
cs_pin: PK5
run_current: .53033
hold_current: .53033
sense_resistor: 0.220
diag1_pin: !PK6
interpolate: True
driver_IHOLDDELAY: 8
driver_TPOWERDOWN: 0
driver_TBL: 2
driver_TOFF: 3
driver_HEND: 1
driver_HSTRT: 5
driver_PWM_FREQ: 2
driver_PWM_GRAD: 4
driver_PWM_AMPL: 200
driver_PWM_AUTOSCALE: True
driver_SGT: 4
interpolate: True
stealthchop_threshold: 80

[tmc2130 extruder]
cs_pin: PK4
interpolate: True
run_current: .513757
hold_current: .513757
sense_resistor: 0.220
diag1_pin: !PK3
driver_IHOLDDELAY: 8
driver_TPOWERDOWN: 0
driver_TBL: 2
driver_TOFF: 3
driver_HEND: 1
driver_HSTRT: 5
driver_PWM_FREQ: 2
driver_PWM_GRAD: 4
driver_PWM_AMPL: 240
driver_PWM_AUTOSCALE: True
driver_SGT: 3
driver_START_SIN: 0 
driver_START_SIN90: 247
driver_MSLUT0: 2863314262 
driver_MSLUT1: 1251300522 
driver_MSLUT2: 608774441 
driver_MSLUT3: 269500962 
driver_MSLUT4: 4160749568 
driver_MSLUT5: 3048961917 
driver_MSLUT6: 1227445590 
driver_MSLUT7: 4211234 
driver_X1:   2
driver_X2: 154
driver_X3: 255
driver_W0:   1
driver_W1:   2
driver_W2:   1
driver_W3:   1

######################################################
###################   Extrudeur   ####################
######################################################
[extruder]
step_pin: PC3
dir_pin: PL6
enable_pin: !PA4
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 22.85696
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: PE5
sensor_type: ATC Semitec 104GT-2
sensor_pin: PF0
min_temp: 0
max_temp: 305
min_extrude_temp: 185
max_extrude_cross_section: 50.0
max_extrude_only_distance: 500.0
max_extrude_only_velocity: 120.0
max_extrude_only_accel: 1250.0
pressure_advance: 0.05
pressure_advance_smooth_time: 0.040

######################################################
###################      Bed      ####################
######################################################
[heater_bed]
heater_pin: PG5
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF2
#control: pid
#pid_Kp: 52.924
#pid_Ki: 0.661
#pid_Kd: 1059.794
min_temp: 0
max_temp: 125

######################################################
###################     Fan       ####################
######################################################
[heater_fan nozzle_cooling_fan]
pin: PH5
heater: extruder
heater_temp: 50.0
fan_speed: 1.0

[fan]
pin: PH3



######################################################
###################    Printer    ####################
######################################################
[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 2000
max_accel_to_decel: 2000
max_z_velocity: 15
max_z_accel: 300



######################################################
###################    Sensor     ####################
######################################################
[temperature_sensor einsy_board]
sensor_pin: PF6
sensor_type: TDK NTCG104LH104JT1
min_temp: -10
max_temp: 70

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 10
max_temp: 80

[filament_switch_sensor filament_sensor]
pause_on_runout: True
runout_gcode:
    M118 Filament Runout Detected
    PAUSE
insert_gcode:
    M118 Filament Load Detected
    LOAD_FILAMENT
event_delay: 3.0
pause_delay: 0.01
switch_pin: !PK0

######################################################
###################     Mesh      ####################
######################################################
[bed_mesh]
algorithm: bicubic
fade_end: 10
faulty_region_1_min: 100.583, 187.376
faulty_region_1_max: 122.083, 229.376
faulty_region_2_min: 125.672, -18.124
faulty_region_2_max: 147.172, 23.876
faulty_region_3_min: 192.261, 5.126
faulty_region_3_max: 234.261, 26.626
faulty_region_4_min: 114.422, 39.876
faulty_region_4_max: 135.922, 81.876
faulty_region_5_min: 21.422, 87.126
faulty_region_5_max: 42.922, 129.126
faulty_region_6_min: 54.172, 97.376
faulty_region_6_max: 96.172, 118.876
faulty_region_7_min: 154.172, 97.376
faulty_region_7_max: 196.172, 118.876
faulty_region_8_min: 205.136, 87.126
faulty_region_8_max: 226.636, 129.126
faulty_region_9_min: 114.422, 134.376
faulty_region_9_max: 135.922, 176.376
faulty_region_10_min: 176.177, 191.394
faulty_region_10_max: 218.177, 212.894
horizontal_move_z: 5 #2
mesh_max: 228,210
mesh_min: 24, 6
mesh_pps: 3
probe_count: 4,4
speed: 200


######################################################
###################      Home     ####################
######################################################
[safe_z_home]
home_xy_position: 153,132
speed: 50.0
z_hop: 15
z_hop_speed: 15.0
move_to_previous: False

######################################################
###################   Input Shaper   #################
######################################################
[input_shaper]



######################################################
#######################   Other  #####################
######################################################
[probe]
pin: PB4
x_offset: 23
y_offset: 5
speed: 20.0
samples: 3 # Sampling, primarily for bed mesh. 3 is fine for normal PINDA probes.
samples_result: average
sample_retract_dist: 1.0

[gcode_arcs]
resolution: 0.25

[bed_screws]
screw1: 13,6
screw1_name: Front Left
screw2: 13,115
screw2_name: Front Center
screw3: 13,210
screw3_name: Front Right

screw4: 123,6
screw4_name: Center Left
screw5: 123,210
screw5_name: Center Right

screw6: 228,6
screw6_name: Back Left
screw7: 228,115
screw7_name: Back Center
screw8: 228,210
screw8_name: Back Right

[gcode_arcs]
resolution: 0.25

[static_digital_output debug_led]
pins: !PB7

[output_pin BEEPER_pin]
pin: PH2
pwm: True
value: 0
shutdown_value:0
cycle_time: 0.001
scale: 1000

[respond]
default_type: command

[skew_correction]

[display_status]

[pause_resume]

[force_move]
enable_force_move: True

[probe]
#z_offset = -1.673



######################################################
#######################   LCD  #######################
######################################################
[output_pin LCD_backlight_pin]
pin: PE3
pwm: True
hardware_pwm: True

value: 0.01       # 1% of backlight
shutdown_value: 1 # Back to full backlight (without PWM) on restart
cycle_time: 0.001 # Default 0.1s cycle time flickers as hell

[display]
lcd_type: hd44780
rs_pin: PD5
e_pin: PF7
d4_pin: PF5
d5_pin: PG4
d6_pin: PH7
d7_pin: PG3
encoder_pins: ^PJ1,^PJ2
click_pin: ^!PH6

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PC5,  EXP1_3=PD13, EXP1_5=PE14, EXP1_7=PD11, EXP1_9=<GND>,
    EXP1_2=PE13, EXP1_4=PC6,  EXP1_6=PE15, EXP1_8=PD10, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PA6, EXP2_3=PE8, EXP2_5=PE11, EXP2_7=PE12,  EXP2_9=<GND>,
    EXP2_2=PA5, EXP2_4=PE10, EXP2_6=PA7, EXP2_8=<RST>, EXP2_10=<3.3v>
    # Pins EXP2_1, EXP2_6, EXP2_2 are also MISO, MOSI, SCK of bus "ssp1"

########################################
# ADXL Paramètres Compensation de Résonance
########################################
# Fonction adxl345 pour les tests de résonances --> Activer/Désactiver [PIS.cfg]  -- Configurations dans la section [input_shaper] -- Voir : 
[mcu rpi]
serial: /tmp/klipper_host_mcu

[adxl345]
cs_pin: rpi:gpio13
spi_bus: spidev1.0

[resonance_tester]
accel_chip: adxl345
accel_per_hz: 130 #50
probe_points:
    150, 150, 20  # an example

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 19.489
#*# pid_ki = 0.778
#*# pid_kd = 122.048
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.348
#*# pid_ki = 1.249
#*# pid_kd = 309.864
#*#
#*# [probe]
#*# z_offset = 1.784
#*#
#*# [input_shaper]
#*# shaper_type_y = mzv
#*# shaper_freq_y = 37.0
#*# shaper_type_x = ei
#*# shaper_freq_x = 55.8
